<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Text data in Corpus and other packages</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Text data in Corpus and other packages</h1>



<div id="text-data-type" class="section level2">
<h2>Text data type</h2>
<p>The <em>corpus</em> package does not define a special corpus object, but it does define a new data type, <code>corpus_text</code>, for storing a collection of texts. You can create values of this type using the <code>as_corpus_text()</code> or <code>as_corpus_frame()</code> function.</p>
<p>Take, for example, the following sample text, created as an R character vector.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># raw text for the first two paragraphs of _The Tale of Peter Rabbit_,</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co"># by Beatrix Potter</span></a>
<a class="sourceLine" id="cb1-3" title="3">raw &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="dt">para1 =</span></a>
<a class="sourceLine" id="cb1-5" title="5">        <span class="kw">paste</span>(<span class="st">&quot;Once upon a time there were four little Rabbits,&quot;</span>,</a>
<a class="sourceLine" id="cb1-6" title="6">              <span class="st">&quot;and their names were: Flopsy, Mopsy, Cottontail, and Peter.&quot;</span>,</a>
<a class="sourceLine" id="cb1-7" title="7">              <span class="st">&quot;They lived with their Mother in a sandbank,&quot;</span>,</a>
<a class="sourceLine" id="cb1-8" title="8">              <span class="st">&quot;underneath the root of a very big fir tree.&quot;</span>,</a>
<a class="sourceLine" id="cb1-9" title="9">              <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>),</a>
<a class="sourceLine" id="cb1-10" title="10">    <span class="dt">para2 =</span></a>
<a class="sourceLine" id="cb1-11" title="11">        <span class="kw">paste</span>(<span class="st">&quot;&#39;Now, my dears,&#39; said old Mrs. Rabbit one morning,&quot;</span>,</a>
<a class="sourceLine" id="cb1-12" title="12">              <span class="st">&quot;&#39;you may go into the fields or down the lane,&quot;</span>,</a>
<a class="sourceLine" id="cb1-13" title="13">              <span class="st">&quot;but don&#39;t go into Mr. McGregor&#39;s garden --&quot;</span>,</a>
<a class="sourceLine" id="cb1-14" title="14">              <span class="st">&quot;your Father had an accident there;&quot;</span>,</a>
<a class="sourceLine" id="cb1-15" title="15">              <span class="st">&quot;he was put in a pie by Mrs. McGregor.&#39;&quot;</span>,</a>
<a class="sourceLine" id="cb1-16" title="16">              <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))</a></code></pre></div>
<p>We can convert the text to a <code>corpus_text</code> object using the <code>as_corpus_text()</code> function:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">text &lt;-<span class="st"> </span><span class="kw">as_corpus_text</span>(raw)</a></code></pre></div>
<p>Alternatively, we can convert it to a data frame with a column named <code>&quot;text&quot;</code> of type <code>corpus_text</code> using the <code>as_corpus_frame()</code> function:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">data &lt;-<span class="st"> </span><span class="kw">as_corpus_frame</span>(raw)</a></code></pre></div>
<p>Both <code>as_corpus_frame()</code> and <code>as_corpus_text()</code> are generic; they work on character vectors, data frames, <em>tm</em> <code>Corpus</code> objects, and <em>quanteda</em> <code>corpus</code> objects. Whenever you call a <em>corpus</em> function expecting text, that function calls <code>as_corpus_text()</code> on its input. We will see some examples of converting <em>tm</em> and <em>quanteda</em> objects below.</p>
<p>The <code>corpus_text</code> type behaves like an R character vector in most respects, but using this type enables some new features.</p>
</div>
<div id="text-filter" class="section level2">
<h2>Text filter</h2>
<p>Each <code>corpus_text</code> object has a <code>text_filter</code> property that can be get or set using the <code>text_filter()</code> generic function. This property allows us to specify the preprocessing decisions that define the text normalization, token, and sentence boundaries.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># get the text filter</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">print</span>(<span class="kw">text_filter</span>(text))</a></code></pre></div>
<pre><code>Text filter with the following options:

    map_case: TRUE
    map_quote: TRUE
    remove_ignorable: TRUE
    combine: NULL
    stemmer: NULL
    stem_dropped: FALSE
    stem_except: NULL
    drop_letter: FALSE
    drop_number: FALSE
    drop_punct: FALSE
    drop_symbol: FALSE
    drop: NULL
    drop_except: NULL
    connector: _
    sent_crlf: FALSE
    sent_suppress:  chr [1:155] &quot;A.&quot; &quot;A.D.&quot; &quot;a.m.&quot; &quot;A.M.&quot; &quot;A.S.&quot; &quot;AA.&quot; &quot;AB.&quot; &quot;Abs.&quot; &quot;AD.&quot; ...</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># set a new text filter</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">text_filter</span>(text) &lt;-<span class="st"> </span><span class="kw">text_filter</span>(<span class="dt">drop_punct =</span> <span class="ot">TRUE</span>, <span class="dt">drop =</span> stopwords_en)</a>
<a class="sourceLine" id="cb6-3" title="3"></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co"># update a text filter property</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="kw">text_filter</span>(text)<span class="op">$</span>drop_punct &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb6-6" title="6"></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co"># switch to the default text filter</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="kw">text_filter</span>(text) &lt;-<span class="st"> </span><span class="ot">NULL</span></a></code></pre></div>
</div>
<div id="valid-utf-8" class="section level2">
<h2>Valid UTF-8</h2>
<p>All <code>corpus_text</code> objects contain valid UTF-8 data. It is impossible to create a <code>corpus_text</code> object with invalid UTF-8:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># the input is encoded in Latin-1, but declared as UTF-8</span></a>
<a class="sourceLine" id="cb7-2" title="2">x &lt;-<span class="st"> &quot;fa</span><span class="ch">\xE7</span><span class="st">ile&quot;</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">Encoding</span>(x) &lt;-<span class="st"> &quot;UTF-8&quot;</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="kw">as_corpus_text</span>(x) <span class="co">## fails</span></a></code></pre></div>
<pre><code>Error in as_corpus_text.character(x): argument entry 1 is incorrectly marked as &quot;UTF-8&quot;: leading byte 0xE7 followed by invalid continuation byte (0x69) at position 4</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">as_corpus_text</span>(<span class="kw">iconv</span>(x, <span class="st">&quot;Latin1&quot;</span>, <span class="st">&quot;UTF-8&quot;</span>)) <span class="co">## succeeds</span></a></code></pre></div>
<pre><code>[1] &quot;façile&quot;</code></pre>
</div>
<div id="unique-names" class="section level2">
<h2>Unique names</h2>
<p>All <code>corpus_text</code> objects have unique names. When you coerce an object with duplicate names to <code>corpus_text</code>, the duplicates get renamed with a warning:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">x &lt;-<span class="st"> </span><span class="kw">as_corpus_text</span>(<span class="kw">c</span>(<span class="dt">a =</span> <span class="st">&quot;hello&quot;</span>, <span class="dt">b =</span> <span class="st">&quot;world&quot;</span>, <span class="dt">a =</span> <span class="st">&quot;repeated name&quot;</span>)) <span class="co"># fails</span></a></code></pre></div>
<pre><code>Warning in as_corpus_text.character(c(a = &quot;hello&quot;, b = &quot;world&quot;, a = &quot;repeated name&quot;)): renaming
entries with duplicate names</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">names</span>(x)</a></code></pre></div>
<pre><code>[1] &quot;a&quot;   &quot;b&quot;   &quot;a.1&quot;</code></pre>
<p>Setting repeated names fails:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="co"># fails, duplicate names</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="kw">names</span>(x) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;a&quot;</span>)</a></code></pre></div>
<pre><code>Error in `names&lt;-.corpus_text`(`*tmp*`, value = c(&quot;a&quot;, &quot;b&quot;, &quot;a&quot;)): duplicate &#39;names&#39; are not allowed</code></pre>
<p>You can set the <code>names</code> to <code>NULL</code> if you don’t want them:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">names</span>(x) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb17-2" title="2"><span class="kw">print</span>(<span class="kw">names</span>(x))</a></code></pre></div>
<pre><code>NULL</code></pre>
</div>
<div id="reference-memory-mapped-data" class="section level2">
<h2>Reference memory-mapped data</h2>
<p><code>corpus_text</code> objects can manage collections of texts that do not fit into memory, through the memory-map interface provided by <code>read_ndjson()</code>. When dealing with such objects, internally the <code>corpus_text</code> object just stores an offset into the file containing the text, not the text itself.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="co"># store some sample data in a newline-delimited JSON file</span></a>
<a class="sourceLine" id="cb19-2" title="2">tmp &lt;-<span class="st"> </span><span class="kw">tempfile</span>()</a>
<a class="sourceLine" id="cb19-3" title="3"><span class="kw">writeLines</span>(<span class="kw">c</span>(<span class="st">&#39;{&quot;text&quot;: &quot;A sample text&quot;, &quot;metadata&quot;: 7 }&#39;</span>,</a>
<a class="sourceLine" id="cb19-4" title="4">             <span class="st">&#39;{&quot;text&quot;: &quot;Another text.&quot;}&#39;</span>,</a>
<a class="sourceLine" id="cb19-5" title="5">             <span class="st">&#39;{&quot;text&quot;: &quot;A third text.&quot;, &quot;metadata&quot;: -100}&#39;</span>),</a>
<a class="sourceLine" id="cb19-6" title="6">           tmp)</a>
<a class="sourceLine" id="cb19-7" title="7"></a>
<a class="sourceLine" id="cb19-8" title="8"><span class="co"># memory-map the &quot;text&quot; field</span></a>
<a class="sourceLine" id="cb19-9" title="9">data &lt;-<span class="st"> </span><span class="kw">read_ndjson</span>(tmp, <span class="dt">text =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">mmap =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb19-10" title="10"></a>
<a class="sourceLine" id="cb19-11" title="11"><span class="co"># display the internal representation of the resulting &#39;corpus_text&#39; object</span></a>
<a class="sourceLine" id="cb19-12" title="12"><span class="kw">unclass</span>(data<span class="op">$</span>text)</a></code></pre></div>
<pre><code>$handle
&lt;pointer: 0x7fba65dd4ba0&gt;

$sources
$sources[[1]]
JSON data set with 3 rows of type text


$table
  source row start stop
1      1   1     1   13
2      1   2     1   13
3      1   3     1   13

$names
NULL

$filter
NULL</code></pre>
<p>Above, the <code>handle</code> component of the text object is a memory-mapped view of the file. The <code>table</code> component stores the row numbers for the data, along with the start and stop indices of the text.</p>
</div>
<div id="reference-substrings-of-other-objects" class="section level2">
<h2>Reference substrings of other objects</h2>
<p><code>corpus_text</code> objects can reference substrings of other R character objects, without copying the parent object. This allows functions like <code>text_split()</code> and <code>text_locate()</code> to quickly split a text into smaller segments without allocating new character strings.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1"><span class="co"># segment text into chunks of at most 10 tokens</span></a>
<a class="sourceLine" id="cb21-2" title="2">(chunks &lt;-<span class="st"> </span><span class="kw">text_split</span>(text, <span class="st">&quot;tokens&quot;</span>, <span class="dv">10</span>))</a></code></pre></div>
<pre><code>   parent index text                                           
1  para1      1 Once upon a time there were four little Rabbits
2  para1      2 ,\nand their names were: Flopsy, Mopsy         
3  para1      3 , Cottontail, and Peter.\nThey lived with      
4  para1      4 their Mother in a sandbank,\nunderneath the    
5  para1      5 root of a very big fir tree.                   
6  para2      1 &#39;Now, my dears,&#39; said old Mrs                  
7  para2      2 . Rabbit one morning,\n&#39;you may go into        
8  para2      3 the fields or down the lane,\nbut don&#39;t        
9  para2      4 go into Mr. McGregor&#39;s garden --\nyour         
10 para2      5 Father had an accident there;\nhe was put      
11 para2      6 in a pie by Mrs. McGregor.&#39;                    </code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="co"># segmenting does not allocate new objects for the segments</span></a>
<a class="sourceLine" id="cb23-2" title="2"><span class="kw">unclass</span>(chunks<span class="op">$</span>text) <span class="co"># inspect text internals</span></a></code></pre></div>
<pre><code>$handle
&lt;pointer: 0x7fba65fa0fb0&gt;

$sources
$sources[[1]]
                                                                                                                                                                                                                      para1 
                  &quot;Once upon a time there were four little Rabbits,\nand their names were: Flopsy, Mopsy, Cottontail, and Peter.\nThey lived with their Mother in a sandbank,\nunderneath the root of a very big fir tree.&quot; 
                                                                                                                                                                                                                      para2 
&quot;&#39;Now, my dears,&#39; said old Mrs. Rabbit one morning,\n&#39;you may go into the fields or down the lane,\nbut don&#39;t go into Mr. McGregor&#39;s garden --\nyour Father had an accident there;\nhe was put in a pie by Mrs. McGregor.&#39;&quot; 


$table
   source row start stop
1       1   1     1   47
2       1   1    48   84
3       1   1    85  125
4       1   1   126  168
5       1   1   169  196
6       1   2     1   29
7       1   2    30   68
8       1   2    69  107
9       1   2   108  145
10      1   2   146  186
11      1   2   187  213

$names
NULL

$filter
NULL</code></pre>
<p>The call to <code>text_split()</code> did not allocate any new character objects; the result uses the same sources, but with different start and stop indices.</p>
</div>
<div id="better-printing" class="section level2">
<h2>Better printing</h2>
<p>Printing <code>corpus_text</code> objects truncates the output at the end of the line instead of printing the entire contents.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1"><span class="co"># print a character object</span></a>
<a class="sourceLine" id="cb25-2" title="2"><span class="kw">print</span>(raw)</a></code></pre></div>
<pre><code>                                                                                                                                                                                                                      para1 
                  &quot;Once upon a time there were four little Rabbits,\nand their names were: Flopsy, Mopsy, Cottontail, and Peter.\nThey lived with their Mother in a sandbank,\nunderneath the root of a very big fir tree.&quot; 
                                                                                                                                                                                                                      para2 
&quot;&#39;Now, my dears,&#39; said old Mrs. Rabbit one morning,\n&#39;you may go into the fields or down the lane,\nbut don&#39;t go into Mr. McGregor&#39;s garden --\nyour Father had an accident there;\nhe was put in a pie by Mrs. McGregor.&#39;&quot; </code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1"><span class="co"># print a corpus_text object</span></a>
<a class="sourceLine" id="cb27-2" title="2"><span class="kw">print</span>(text)</a></code></pre></div>
<pre><code>para1                                                                                          
&quot;Once upon a time there were four little Rabbits,\nand their names were: Flopsy, Mopsy, Cotto…&quot;
para2                                                                                          
&quot;&#39;Now, my dears,&#39; said old Mrs. Rabbit one morning,\n&#39;you may go into the fields or down the …&quot;</code></pre>
<p>If you’d like to print the entire contents, you can convert the text to character and then print:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1"><span class="co"># print entire contents</span></a>
<a class="sourceLine" id="cb29-2" title="2"><span class="kw">print</span>(<span class="kw">as.character</span>(text))</a></code></pre></div>
<pre><code>[1] &quot;Once upon a time there were four little Rabbits,\nand their names were: Flopsy, Mopsy, Cottontail, and Peter.\nThey lived with their Mother in a sandbank,\nunderneath the root of a very big fir tree.&quot;                  
[2] &quot;&#39;Now, my dears,&#39; said old Mrs. Rabbit one morning,\n&#39;you may go into the fields or down the lane,\nbut don&#39;t go into Mr. McGregor&#39;s garden --\nyour Father had an accident there;\nhe was put in a pie by Mrs. McGregor.&#39;&quot;</code></pre>
</div>
<div id="conversion-to-character" class="section level2">
<h2>Conversion to character</h2>
<p>The one disadvantage of using a <code>corpus_text</code> object instead of an R character vector is that many functions from other packages that expect R character vectors will not work on <code>corpus_text</code>. To get around this, you can call <code>as.character</code> on a <code>corpus_text</code> object to convert it to an R character vector.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1"><span class="co"># some R methods coerce their inputs to character; &#39;message&#39; is one example</span></a>
<a class="sourceLine" id="cb31-2" title="2"><span class="kw">message</span>(<span class="kw">as_corpus_text</span>(<span class="st">&quot;hello world&quot;</span>))</a></code></pre></div>
<pre><code>hello world</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1"><span class="co"># others do not;</span></a>
<a class="sourceLine" id="cb33-2" title="2"><span class="kw">cat</span>(<span class="kw">as_corpus_text</span>(<span class="st">&quot;hello world&quot;</span>), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>) <span class="co"># fails</span></a></code></pre></div>
<pre><code>Error in cat(as_corpus_text(&quot;hello world&quot;), &quot;\n&quot;): argument 1 (type &#39;list&#39;) cannot be handled by &#39;cat&#39;</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="co"># we must call &#39;as.character&#39; on the inputs</span></a>
<a class="sourceLine" id="cb35-2" title="2"><span class="kw">cat</span>(<span class="kw">as.character</span>(<span class="kw">as_corpus_text</span>(<span class="st">&quot;hello world&quot;</span>)), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>hello world </code></pre>
</div>
<div id="interface-with-quanteda" class="section level2">
<h2>Interface with <em>quanteda</em></h2>
<p>All <em>corpus</em> functions expecting text work on <em>quanteda</em> corpus objects:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1">uk2010immigCorpus &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb37-2" title="2"><span class="st">    </span>quanteda<span class="op">::</span><span class="kw">corpus</span>(quanteda<span class="op">::</span>data_char_ukimmig2010,</a>
<a class="sourceLine" id="cb37-3" title="3">           <span class="dt">docvars =</span> <span class="kw">data.frame</span>(<span class="dt">party =</span> <span class="kw">names</span>(quanteda<span class="op">::</span>data_char_ukimmig2010)),</a>
<a class="sourceLine" id="cb37-4" title="4">           <span class="dt">metacorpus =</span> <span class="kw">list</span>(<span class="dt">notes =</span> <span class="st">&quot;Immigration-related sections of 2010 UK party manifestos&quot;</span>))</a>
<a class="sourceLine" id="cb37-5" title="5"></a>
<a class="sourceLine" id="cb37-6" title="6"><span class="co"># search for terms in a quanteda corpus that stem to &quot;immigr&quot;:</span></a>
<a class="sourceLine" id="cb37-7" title="7"><span class="kw">text_locate</span>(uk2010immigCorpus, <span class="st">&quot;immigr&quot;</span>, <span class="dt">stemmer =</span> <span class="st">&quot;en&quot;</span>)</a></code></pre></div>
<pre><code>   text                before                  instance                   after                
1  BNP                                        IMMIGRATION : AN UNPARALLELED CRISIS WHICH ONLY …
2  BNP  …THE BNP CAN SOLVE. \n\n- At current  immigration  and birth rates, indigenous British…
3  BNP  … will include a halt to all further  immigration , the deportation of all illegal imm…
4  BNP  …ion, the deportation of all illegal  immigrants  , a halt to the &quot;asylum&quot; swindle and…
5  BNP  …mes in Britain, regardless of their  immigration  status.\n\n- The BNP will review al…
6  BNP  …mission that they orchestrated mass  immigration  to change forcibly Britain&#39;s demogr…
7  BNP  …ce is in grave peril, threatened by  immigration  and multiculturalism. In the absenc…
8  BNP  …Statistics (ONS), legal Third World  immigrants   made up 14.7 percent (7.5 million) …
9  BNP  …rths to second and third generation   immigrant   mothers. Figures released by the ON…
10 BNP  …hen these figures are added in, the   immigrant   birth rate is estimated to be aroun…
11 BNP  …ales.\n\n- The majority of the &#39;new  immigrants  &#39; are not from Eastern Europe, as is…
12 BNP  …imed. According to the ONS figures,  immigrants   from Eastern Europe had 25,000 chil…
13 BNP  …er exponentially, and given current  immigration  and birth rates, will utterly overw…
14 BNP  …s.\n\nThe Disastrous Effect of Mass  Immigration  on British Society\n\nThere is no e…
15 BNP  …here that it is &#39;racist&#39; to discuss  immigration  and population density.\n\nThe word…
16 BNP  …between 300,000-500,000 Third World  immigrants   each year is an issue that all thre…
17 BNP  …d so on.\n\nA Case Study: Crime and  Immigration \n\nImmigration has had a dramatic e…
18 BNP  …ase Study: Crime and Immigration\n\n Immigration  has had a dramatic effect on Britai…
19 BNP  …onately involving ethnic groups.\n\n Immigration  Has Harmed British Jobs\n\nThe conc…
20 BNP  …s working than in 1997.\n\nOverall,  immigrants   have taken up more than 1.64 millio…
⋮  (87 rows total)</code></pre>
<p>You can convert a <em>quanteda</em> corpus to a data frame using <code>as_corpus_frame()</code>, or extract its text using <code>as_corpus_text()</code>:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1"><span class="co"># convert to corpus_text:</span></a>
<a class="sourceLine" id="cb39-2" title="2"><span class="kw">print</span>(<span class="kw">as_corpus_text</span>(uk2010immigCorpus))</a></code></pre></div>
<pre><code>BNP                                                                                            
&quot;IMMIGRATION: AN UNPARALLELED CRISIS WHICH ONLY THE BNP CAN SOLVE. \n\n- At current immigrati…&quot;
Coalition                                                                                      
&quot;IMMIGRATION. \n\nThe Government believes that immigration has enriched our culture and stren…&quot;
Conservative                                                                                   
&quot;Attract the brightest and best to our country.\n\nImmigration has enriched our nation over t…&quot;
Greens                                                                                         
&quot;Immigration.\n\nMigration is a fact of life.  People have always moved from one country to a…&quot;
Labour                                                                                         
&quot;Crime and immigration\n\nThe challenge for Britain\n\nWe will control immigration with our n…&quot;
LibDem                                                                                         
&quot;firm but fair immigration system\n\nBritain has always been an open, welcoming country, and …&quot;
PC                                                                                             
&quot;As a welcoming nation, Plaid Cymru recognises the invaluable contribution that migrants have…&quot;
SNP                                                                                            
&quot;And we will argue for Scotland to take responsibility for immigration so that we can develop…&quot;
UKIP                                                                                           
&quot;Immigration &amp; Asylum.\n\nAs a member of the EU, Britain has lost control of her borders. Som…&quot;</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1"><span class="co"># convert to data frame:</span></a>
<a class="sourceLine" id="cb41-2" title="2"><span class="kw">print</span>(<span class="kw">as_corpus_frame</span>(uk2010immigCorpus))</a></code></pre></div>
<pre><code>             party        text                                                                 
BNP          BNP          IMMIGRATION: AN UNPARALLELED CRISIS WHICH ONLY THE BNP CAN SOLVE. \n…
Coalition    Coalition    IMMIGRATION. \n\nThe Government believes that immigration has enrich…
Conservative Conservative Attract the brightest and best to our country.\n\nImmigration has en…
Greens       Greens       Immigration.\n\nMigration is a fact of life.  People have always mov…
Labour       Labour       Crime and immigration\n\nThe challenge for Britain\n\nWe will contro…
LibDem       LibDem       firm but fair immigration system\n\nBritain has always been an open,…
PC           PC           As a welcoming nation, Plaid Cymru recognises the invaluable contrib…
SNP          SNP          And we will argue for Scotland to take responsibility for immigratio…
UKIP         UKIP         Immigration &amp; Asylum.\n\nAs a member of the EU, Britain has lost con…</code></pre>
</div>
<div id="interface-with-tm" class="section level2">
<h2>Interface with <em>tm</em></h2>
<p>All <em>corpus</em> functions expecting text also work on <em>tm</em> Corpus objects:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1"><span class="kw">data</span>(<span class="st">&quot;crude&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;tm&quot;</span>)</a>
<a class="sourceLine" id="cb43-2" title="2"></a>
<a class="sourceLine" id="cb43-3" title="3"><span class="co"># get the top terms in a tm corpus:</span></a>
<a class="sourceLine" id="cb43-4" title="4"><span class="kw">term_stats</span>(crude, <span class="dt">drop_punct =</span> <span class="ot">TRUE</span>, <span class="dt">drop =</span> stopwords_en)</a></code></pre></div>
<pre><code>   term      count support
1  oil          85      20
2  said         73      20
3  reuter       20      20
4  prices       48      15
5  last         24      12
6  one          17      12
7  dlrs         23      11
8  opec         44      10
9  barrel       15      10
10 mln          31       9
11 crude        21       9
12 new          14       9
13 pct          14       9
14 price        13       9
15 also          9       9
16 petroleum     9       9
17 market       20       8
18 barrels      11       8
19 industry     10       8
20 world        10       8
⋮  (1042 rows total)</code></pre>
<p>The <code>as_corpus_frame()</code> and <code>as_corpus_text()</code> functions also work on <em>tm</em> Corpus objects:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1"><span class="co"># convert to corpus_text</span></a>
<a class="sourceLine" id="cb45-2" title="2"><span class="kw">print</span>(<span class="kw">as_corpus_text</span>(crude))</a></code></pre></div>
<pre><code>127                                                                                            
&quot;Diamond Shamrock Corp said that\neffective today it had cut its contract prices for crude oi…&quot;
144                                                                                            
&quot;OPEC may be forced to meet before a\nscheduled June session to readdress its production cutt…&quot;
191                                                                                            
&quot;Texaco Canada said it lowered the\ncontract price it will pay for crude oil 64 Canadian cts …&quot;
194                                                                                            
&quot;Marathon Petroleum Co said it reduced\nthe contract price it will pay for all grades of crud…&quot;
211                                                                                            
&quot;Houston Oil Trust said that independent\npetroleum engineers completed an annual study that …&quot;
236                                                                                            
&quot;Kuwait\&quot;s Oil Minister, in remarks\npublished today, said there were no plans for an emergen…&quot;
237                                                                                            
&quot;Indonesia appears to be nearing a\npolitical crossroads over measures to deregulate its prot…&quot;
242                                                                                            
&quot;Saudi riyal interbank deposits were\nsteady at yesterday&#39;s higher levels in a quiet market.…&quot; 
246                                                                                            
&quot;The Gulf oil state of Qatar, recovering\nslightly from last year&#39;s decline in world oil pric…&quot;
248                                                                                            
&quot;Saudi Arabian Oil Minister Hisham Nazer\nreiterated the kingdom&#39;s commitment to last Decembe…&quot;
273                                                                                            
&quot;Saudi crude oil output last month fell\nto an average of 3.5 mln barrels per day (bpd) from …&quot;
349                                                                                            
&quot;Deputy oil ministers from six Gulf\nArab states will meet in Bahrain today to discuss coordi…&quot;
352                                                                                            
&quot;Saudi Arabian Oil Minister Hisham Nazer\nreiterated the kingdom&#39;s commitment to last Decembe…&quot;
353                                                                                            
&quot;Kuwait&#39;s oil minister said in a newspaper\ninterview that there were no plans for an emergen…&quot;
368                                                                                            
&quot;The port of Philadelphia was closed\nwhen a Cypriot oil tanker, Seapride II, ran aground aft…&quot;
489                                                                                            
&quot;A study group said the United States\nshould increase its strategic petroleum reserve to one…&quot;
502                                                                                            
&quot;A study group said the United States\nshould increase its strategic petroleum reserve to one…&quot;
543                                                                                            
&quot;Unocal Corp&#39;s Union Oil Co said it\nlowered its posted prices for crude oil one to 1.50 dlrs…&quot;
704                                                                                            
&quot;The New York Mercantile Exchange set\nApril one for the debut of a new procedure in the ener…&quot;
708                                                                                            
&quot;Argentine crude oil production was\ndown 10.8 pct in January 1987 to 12.32 mln barrels, from…&quot;</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1"><span class="co"># convert to data frame</span></a>
<a class="sourceLine" id="cb47-2" title="2"><span class="kw">print</span>(<span class="kw">as_corpus_frame</span>(crude))</a></code></pre></div>
<pre><code>    text                                                                                       
127 Diamond Shamrock Corp said that\neffective today it had cut its contract prices for crude …
144 OPEC may be forced to meet before a\nscheduled June session to readdress its production cu…
191 Texaco Canada said it lowered the\ncontract price it will pay for crude oil 64 Canadian ct…
194 Marathon Petroleum Co said it reduced\nthe contract price it will pay for all grades of cr…
211 Houston Oil Trust said that independent\npetroleum engineers completed an annual study tha…
236 Kuwait&quot;s Oil Minister, in remarks\npublished today, said there were no plans for an emerge…
237 Indonesia appears to be nearing a\npolitical crossroads over measures to deregulate its pr…
242 Saudi riyal interbank deposits were\nsteady at yesterday&#39;s higher levels in a quiet market…
246 The Gulf oil state of Qatar, recovering\nslightly from last year&#39;s decline in world oil pr…
248 Saudi Arabian Oil Minister Hisham Nazer\nreiterated the kingdom&#39;s commitment to last Decem…
273 Saudi crude oil output last month fell\nto an average of 3.5 mln barrels per day (bpd) fro…
349 Deputy oil ministers from six Gulf\nArab states will meet in Bahrain today to discuss coor…
352 Saudi Arabian Oil Minister Hisham Nazer\nreiterated the kingdom&#39;s commitment to last Decem…
353 Kuwait&#39;s oil minister said in a newspaper\ninterview that there were no plans for an emerg…
368 The port of Philadelphia was closed\nwhen a Cypriot oil tanker, Seapride II, ran aground a…
489 A study group said the United States\nshould increase its strategic petroleum reserve to o…
502 A study group said the United States\nshould increase its strategic petroleum reserve to o…
543 Unocal Corp&#39;s Union Oil Co said it\nlowered its posted prices for crude oil one to 1.50 dl…
704 The New York Mercantile Exchange set\nApril one for the debut of a new procedure in the en…
708 Argentine crude oil production was\ndown 10.8 pct in January 1987 to 12.32 mln barrels, fr…</code></pre>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
