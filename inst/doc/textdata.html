<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Text data in Corpus and other packages</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Text data in Corpus and other packages</h1>



<div id="text-data-type" class="section level2">
<h2>Text data type</h2>
<p>The <em>corpus</em> package does not define a special corpus object, but it does define a new data type, <code>corpus_text</code>, for storing a collection of texts. You can create values of this type using the <code>as_corpus_text()</code> or <code>as_corpus_frame()</code> function.</p>
<p>Take, for example, the following sample text, created as an R character vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># raw text for the first two paragraphs of _The Tale of Peter Rabbit_,</span>
<span class="co"># by Beatrix Potter</span>
raw &lt;-<span class="st"> </span><span class="kw">c</span>(
    <span class="dt">para1 =</span>
        <span class="kw">paste</span>(<span class="st">&quot;Once upon a time there were four little Rabbits,&quot;</span>,
              <span class="st">&quot;and their names were: Flopsy, Mopsy, Cottontail, and Peter.&quot;</span>,
              <span class="st">&quot;They lived with their Mother in a sandbank,&quot;</span>,
              <span class="st">&quot;underneath the root of a very big fir tree.&quot;</span>,
              <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>),
    <span class="dt">para2 =</span>
        <span class="kw">paste</span>(<span class="st">&quot;'Now, my dears,' said old Mrs. Rabbit one morning,&quot;</span>,
              <span class="st">&quot;'you may go into the fields or down the lane,&quot;</span>,
              <span class="st">&quot;but don't go into Mr. McGregor's garden --&quot;</span>,
              <span class="st">&quot;your Father had an accident there;&quot;</span>,
              <span class="st">&quot;he was put in a pie by Mrs. McGregor.'&quot;</span>,
              <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))</code></pre></div>
<p>We can convert the text to a <code>corpus_text</code> object using the <code>as_corpus_text()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">text &lt;-<span class="st"> </span><span class="kw">as_corpus_text</span>(raw)</code></pre></div>
<p>Alternatively, we can convert it to a data frame with a column named <code>&quot;text&quot;</code> of type <code>corpus_text</code> using the <code>as_corpus_frame()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">as_corpus_frame</span>(raw)</code></pre></div>
<p>Both <code>as_corpus_frame()</code> and <code>as_corpus_text()</code> are generic; they work on character vectors, data frames, <em>tm</em> <code>Corpus</code> objects, and <em>quanteda</em> <code>corpus</code> objects. Whenever you call a <em>corpus</em> function expecting text, that function calls <code>as_corpus_text()</code> on its input. We will see some examples of converting <em>tm</em> and <em>quanteda</em> objects below.</p>
<p>The <code>corpus_text</code> type behaves like an R character vector in most respects, but using this type enables some new features.</p>
</div>
<div id="text-filter" class="section level2">
<h2>Text filter</h2>
<p>Each <code>corpus_text</code> object has a <code>text_filter</code> property that can be get or set using the <code>text_filter()</code> generic function. This property allows us to specify the preprocessing decisions that define the text normalization, token, and sentence boundaries.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get the text filter</span>
<span class="kw">print</span>(<span class="kw">text_filter</span>(text))</code></pre></div>
<pre><code>Text filter with the following options:

    map_case: TRUE
    map_quote: TRUE
    remove_ignorable: TRUE
    combine: NULL
    stemmer: NULL
    stem_dropped: FALSE
    stem_except: NULL
    drop_letter: FALSE
    drop_number: FALSE
    drop_punct: FALSE
    drop_symbol: FALSE
    drop: NULL
    drop_except: NULL
    connector: _
    sent_crlf: FALSE
    sent_suppress:  chr [1:155] &quot;A.&quot; &quot;A.D.&quot; &quot;a.m.&quot; &quot;A.M.&quot; &quot;A.S.&quot; &quot;AA.&quot; &quot;AB.&quot; &quot;Abs.&quot; &quot;AD.&quot; ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># set a new text filter</span>
<span class="kw">text_filter</span>(text) &lt;-<span class="st"> </span><span class="kw">text_filter</span>(<span class="dt">drop_punct =</span> <span class="ot">TRUE</span>, <span class="dt">drop =</span> stopwords_en)

<span class="co"># update a text filter property</span>
<span class="kw">text_filter</span>(text)<span class="op">$</span>drop_punct &lt;-<span class="st"> </span><span class="ot">TRUE</span>

<span class="co"># switch to the default text filter</span>
<span class="kw">text_filter</span>(text) &lt;-<span class="st"> </span><span class="ot">NULL</span></code></pre></div>
</div>
<div id="valid-utf-8" class="section level2">
<h2>Valid UTF-8</h2>
<p>All <code>corpus_text</code> objects contain valid UTF-8 data. It is impossible to create a <code>corpus_text</code> object with invalid UTF-8:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># the input is encoded in Latin-1, but declared as UTF-8</span>
x &lt;-<span class="st"> &quot;fa</span><span class="ch">\xE7</span><span class="st">ile&quot;</span>
<span class="kw">Encoding</span>(x) &lt;-<span class="st"> &quot;UTF-8&quot;</span>
<span class="kw">as_corpus_text</span>(x) ## fails</code></pre></div>
<pre><code>Error in as_corpus_text.character(x): argument entry 1 is marked as &quot;UTF-8&quot; but contains an invalid byte in position 3 (\xe7)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as_corpus_text</span>(<span class="kw">iconv</span>(x, <span class="st">&quot;Latin1&quot;</span>, <span class="st">&quot;UTF-8&quot;</span>)) ## succeeds</code></pre></div>
<pre><code>[1] &quot;façile&quot;</code></pre>
</div>
<div id="unique-names" class="section level2">
<h2>Unique names</h2>
<p>All <code>corpus_text</code> objects have unique names. When you coerce an object with duplicate names to <code>corpus_text</code>, the duplicates get renamed with a warning:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">as_corpus_text</span>(<span class="kw">c</span>(<span class="dt">a =</span> <span class="st">&quot;hello&quot;</span>, <span class="dt">b =</span> <span class="st">&quot;world&quot;</span>, <span class="dt">a =</span> <span class="st">&quot;repeated name&quot;</span>)) <span class="co"># fails</span></code></pre></div>
<pre><code>Warning in as_corpus_text.character(c(a = &quot;hello&quot;, b = &quot;world&quot;, a = &quot;repeated name&quot;)): renaming
entries with duplicate names</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(x)</code></pre></div>
<pre><code>[1] &quot;a&quot;   &quot;b&quot;   &quot;a.1&quot;</code></pre>
<p>Setting repeated names fails:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># fails, duplicate names</span>
<span class="kw">names</span>(x) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;a&quot;</span>)</code></pre></div>
<pre><code>Error in `names&lt;-.corpus_text`(`*tmp*`, value = c(&quot;a&quot;, &quot;b&quot;, &quot;a&quot;)): duplicate 'names' are not allowed</code></pre>
<p>You can set the <code>names</code> to <code>NULL</code> if you don’t want them:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(x) &lt;-<span class="st"> </span><span class="ot">NULL</span>
<span class="kw">print</span>(<span class="kw">names</span>(x))</code></pre></div>
<pre><code>NULL</code></pre>
</div>
<div id="reference-memory-mapped-data" class="section level2">
<h2>Reference memory-mapped data</h2>
<p><code>corpus_text</code> objects can manage collections of texts that do not fit into memory, through the memory-map interface provided by <code>read_ndjson()</code>. When dealing with such objects, internally the <code>corpus_text</code> object just stores an offset into the file containing the text, not the text itself.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># store some sample data in a newline-delimited JSON file</span>
tmp &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
<span class="kw">writeLines</span>(<span class="kw">c</span>(<span class="st">'{&quot;text&quot;: &quot;A sample text&quot;, &quot;metadata&quot;: 7 }'</span>,
             <span class="st">'{&quot;text&quot;: &quot;Another text.&quot;}'</span>,
             <span class="st">'{&quot;text&quot;: &quot;A third text.&quot;, &quot;metadata&quot;: -100}'</span>),
           tmp)

<span class="co"># memory-map the &quot;text&quot; field</span>
data &lt;-<span class="st"> </span><span class="kw">read_ndjson</span>(tmp, <span class="dt">text =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">mmap =</span> <span class="ot">TRUE</span>)

<span class="co"># display the internal representation of the resulting 'corpus_text' object</span>
<span class="kw">unclass</span>(data<span class="op">$</span>text)</code></pre></div>
<pre><code>$handle
&lt;pointer: 0x7f978d7534c0&gt;

$sources
$sources[[1]]
JSON data set with 3 rows of type text


$table
  source row start stop
1      1   1     1   13
2      1   2     1   13
3      1   3     1   13

$names
NULL

$filter
NULL</code></pre>
<p>Above, the <code>handle</code> component of the text object is a memory-mapped view of the file. The <code>table</code> component stores the row numbers for the data, along with the start and stop indices of the text.</p>
</div>
<div id="reference-substrings-of-other-objects" class="section level2">
<h2>Reference substrings of other objects</h2>
<p><code>corpus_text</code> objects can reference substrings of other R character objects, without copying the parent object. This allows functions like <code>text_split()</code> and <code>text_locate()</code> to quickly split a text into smaller segments without allocating new character strings.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># segment text into chunks of at most 10 tokens</span>
(chunks &lt;-<span class="st"> </span><span class="kw">text_split</span>(text, <span class="st">&quot;tokens&quot;</span>, <span class="dv">10</span>))</code></pre></div>
<pre><code>   parent index text                                           
1  para1      1 Once upon a time there were four little Rabbits
2  para1      2 ,\nand their names were: Flopsy, Mopsy         
3  para1      3 , Cottontail, and Peter.\nThey lived with      
4  para1      4 their Mother in a sandbank,\nunderneath the    
5  para1      5 root of a very big fir tree.                   
6  para2      1 'Now, my dears,' said old Mrs                  
7  para2      2 . Rabbit one morning,\n'you may go into        
8  para2      3 the fields or down the lane,\nbut don't        
9  para2      4 go into Mr. McGregor's garden --\nyour         
10 para2      5 Father had an accident there;\nhe was put      
11 para2      6 in a pie by Mrs. McGregor.'                    </code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># segmenting does not allocate new objects for the segments</span>
<span class="kw">unclass</span>(chunks<span class="op">$</span>text) <span class="co"># inspect text internals</span></code></pre></div>
<pre><code>$handle
&lt;pointer: 0x7f978d6e4bc0&gt;

$sources
$sources[[1]]
                                                                                                                                                                                                                      para1 
                  &quot;Once upon a time there were four little Rabbits,\nand their names were: Flopsy, Mopsy, Cottontail, and Peter.\nThey lived with their Mother in a sandbank,\nunderneath the root of a very big fir tree.&quot; 
                                                                                                                                                                                                                      para2 
&quot;'Now, my dears,' said old Mrs. Rabbit one morning,\n'you may go into the fields or down the lane,\nbut don't go into Mr. McGregor's garden --\nyour Father had an accident there;\nhe was put in a pie by Mrs. McGregor.'&quot; 


$table
   source row start stop
1       1   1     1   47
2       1   1    48   84
3       1   1    85  125
4       1   1   126  168
5       1   1   169  196
6       1   2     1   29
7       1   2    30   68
8       1   2    69  107
9       1   2   108  145
10      1   2   146  186
11      1   2   187  213

$names
NULL

$filter
NULL</code></pre>
<p>The call to <code>text_split()</code> did not allocate any new character objects; the result uses the same sources, but with different start and stop indices.</p>
</div>
<div id="better-printing" class="section level2">
<h2>Better printing</h2>
<p>Printing <code>corpus_text</code> objects truncates the output at the end of the line instead of printing the entire contents.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># print a character object</span>
<span class="kw">print</span>(raw)</code></pre></div>
<pre><code>                                                                                                                                                                                                                      para1 
                  &quot;Once upon a time there were four little Rabbits,\nand their names were: Flopsy, Mopsy, Cottontail, and Peter.\nThey lived with their Mother in a sandbank,\nunderneath the root of a very big fir tree.&quot; 
                                                                                                                                                                                                                      para2 
&quot;'Now, my dears,' said old Mrs. Rabbit one morning,\n'you may go into the fields or down the lane,\nbut don't go into Mr. McGregor's garden --\nyour Father had an accident there;\nhe was put in a pie by Mrs. McGregor.'&quot; </code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># print a corpus_text object</span>
<span class="kw">print</span>(text)</code></pre></div>
<pre><code>para1 &quot;Once upon a time there were four little Rabbits,\nand their names were: Flopsy, Mopsy, Cott…&quot;
para2 &quot;'Now, my dears,' said old Mrs. Rabbit one morning,\n'you may go into the fields or down the…&quot;</code></pre>
<p>If you’d like to print the entire contents, you can convert the text to character and then print:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># print entire contents</span>
<span class="kw">print</span>(<span class="kw">as.character</span>(text))</code></pre></div>
<pre><code>[1] &quot;Once upon a time there were four little Rabbits,\nand their names were: Flopsy, Mopsy, Cottontail, and Peter.\nThey lived with their Mother in a sandbank,\nunderneath the root of a very big fir tree.&quot;                  
[2] &quot;'Now, my dears,' said old Mrs. Rabbit one morning,\n'you may go into the fields or down the lane,\nbut don't go into Mr. McGregor's garden --\nyour Father had an accident there;\nhe was put in a pie by Mrs. McGregor.'&quot;</code></pre>
</div>
<div id="conversion-to-character" class="section level2">
<h2>Conversion to character</h2>
<p>The one disadvantage of using a <code>corpus_text</code> object instead of an R character vector is that many functions from other packages that expect R character vectors will not work on <code>corpus_text</code>. To get around this, you can call <code>as.character</code> on a <code>corpus_text</code> object to convert it to an R character vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># some R methods coerce their inputs to character; 'message' is one example</span>
<span class="kw">message</span>(<span class="kw">as_corpus_text</span>(<span class="st">&quot;hello world&quot;</span>))</code></pre></div>
<pre><code>hello world</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># others do not;</span>
<span class="kw">cat</span>(<span class="kw">as_corpus_text</span>(<span class="st">&quot;hello world&quot;</span>), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>) <span class="co"># fails</span></code></pre></div>
<pre><code>Error in cat(as_corpus_text(&quot;hello world&quot;), &quot;\n&quot;): argument 1 (type 'list') cannot be handled by 'cat'</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># we must call 'as.character' on the inputs</span>
<span class="kw">cat</span>(<span class="kw">as.character</span>(<span class="kw">as_corpus_text</span>(<span class="st">&quot;hello world&quot;</span>)), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</code></pre></div>
<pre><code>hello world </code></pre>
</div>
<div id="interface-with-quanteda" class="section level2">
<h2>Interface with <em>quanteda</em></h2>
<p>All <em>corpus</em> functions expecting text work on <em>quanteda</em> corpus objects:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">uk2010immigCorpus &lt;-<span class="st"> </span>
<span class="st">    </span>quanteda<span class="op">::</span><span class="kw">corpus</span>(quanteda<span class="op">::</span>data_char_ukimmig2010,
           <span class="dt">docvars =</span> <span class="kw">data.frame</span>(<span class="dt">party =</span> <span class="kw">names</span>(quanteda<span class="op">::</span>data_char_ukimmig2010)),
           <span class="dt">metacorpus =</span> <span class="kw">list</span>(<span class="dt">notes =</span> <span class="st">&quot;Immigration-related sections of 2010 UK party manifestos&quot;</span>))

<span class="co"># search for terms in a quanteda corpus that stem to &quot;immigr&quot;:</span>
<span class="kw">text_locate</span>(uk2010immigCorpus, <span class="st">&quot;immigr&quot;</span>, <span class="dt">stemmer =</span> <span class="st">&quot;en&quot;</span>)</code></pre></div>
<pre><code>   text                 before                   instance                    after                  
1  BNP                                          IMMIGRATION : AN UNPARALLELED CRISIS WHICH ONLY THE…
2  BNP  …Y THE BNP CAN SOLVE. \n\n- At current  immigration  and birth rates, indigenous British pe…
3  BNP  …ps will include a halt to all further  immigration , the deportation of all illegal immigr…
4  BNP  …ation, the deportation of all illegal  immigrants  , a halt to the &quot;asylum&quot; swindle and th…
5  BNP  …rimes in Britain, regardless of their  immigration  status.\n\n- The BNP will review all c…
6  BNP  …admission that they orchestrated mass  immigration  to change forcibly Britain's demograph…
7  BNP  …ence is in grave peril, threatened by  immigration  and multiculturalism. In the absence o…
8  BNP  …l Statistics (ONS), legal Third World  immigrants   made up 14.7 percent (7.5 million) of …
9  BNP  …births to second and third generation   immigrant   mothers. Figures released by the ONS i…
10 BNP  … When these figures are added in, the   immigrant   birth rate is estimated to be around 5…
11 BNP  … Wales.\n\n- The majority of the 'new  immigrants  ' are not from Eastern Europe, as is of…
12 BNP  …laimed. According to the ONS figures,  immigrants   from Eastern Europe had 25,000 childre…
13 BNP  …mber exponentially, and given current  immigration  and birth rates, will utterly overwhel…
14 BNP  …ars.\n\nThe Disastrous Effect of Mass  Immigration  on British Society\n\nThere is no esca…
15 BNP  …ewhere that it is 'racist' to discuss  immigration  and population density.\n\nThe word 'r…
16 BNP  …f between 300,000-500,000 Third World  immigrants   each year is an issue that all three o…
17 BNP  …and so on.\n\nA Case Study: Crime and  Immigration \n\nImmigration has had a dramatic effe…
18 BNP  … Case Study: Crime and Immigration\n\n Immigration  has had a dramatic effect on Britain's…
19 BNP  …tionately involving ethnic groups.\n\n Immigration  Has Harmed British Jobs\n\nThe concept…
20 BNP  …ons working than in 1997.\n\nOverall,  immigrants   have taken up more than 1.64 million o…
⋮  (87 rows total)</code></pre>
<p>You can convert a <em>quanteda</em> corpus to a data frame using <code>as_corpus_frame()</code>, or extract its text using <code>as_corpus_text()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># convert to corpus_text:</span>
<span class="kw">print</span>(<span class="kw">as_corpus_text</span>(uk2010immigCorpus))</code></pre></div>
<pre><code>BNP          &quot;IMMIGRATION: AN UNPARALLELED CRISIS WHICH ONLY THE BNP CAN SOLVE. \n\n- At current i…&quot;
Coalition    &quot;IMMIGRATION. \n\nThe Government believes that immigration has enriched our culture a…&quot;
Conservative &quot;Attract the brightest and best to our country.\n\nImmigration has enriched our natio…&quot;
Greens       &quot;Immigration.\n\nMigration is a fact of life.  People have always moved from one coun…&quot;
Labour       &quot;Crime and immigration\n\nThe challenge for Britain\n\nWe will control immigration wi…&quot;
LibDem       &quot;firm but fair immigration system\n\nBritain has always been an open, welcoming count…&quot;
PC           &quot;As a welcoming nation, Plaid Cymru recognises the invaluable contribution that migra…&quot;
SNP          &quot;And we will argue for Scotland to take responsibility for immigration so that we can…&quot;
UKIP         &quot;Immigration &amp; Asylum.\n\nAs a member of the EU, Britain has lost control of her bord…&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># convert to data frame:</span>
<span class="kw">print</span>(<span class="kw">as_corpus_frame</span>(uk2010immigCorpus))</code></pre></div>
<pre><code>             party        text                                                                      
BNP          BNP          IMMIGRATION: AN UNPARALLELED CRISIS WHICH ONLY THE BNP CAN SOLVE. \n\n- A…
Coalition    Coalition    IMMIGRATION. \n\nThe Government believes that immigration has enriched ou…
Conservative Conservative Attract the brightest and best to our country.\n\nImmigration has enriche…
Greens       Greens       Immigration.\n\nMigration is a fact of life.  People have always moved fr…
Labour       Labour       Crime and immigration\n\nThe challenge for Britain\n\nWe will control imm…
LibDem       LibDem       firm but fair immigration system\n\nBritain has always been an open, welc…
PC           PC           As a welcoming nation, Plaid Cymru recognises the invaluable contribution…
SNP          SNP          And we will argue for Scotland to take responsibility for immigration so …
UKIP         UKIP         Immigration &amp; Asylum.\n\nAs a member of the EU, Britain has lost control …</code></pre>
</div>
<div id="interface-with-tm" class="section level2">
<h2>Interface with <em>tm</em></h2>
<p>All <em>corpus</em> functions expecting text also work on <em>tm</em> Corpus objects:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;crude&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;tm&quot;</span>)

<span class="co"># get the top terms in a tm corpus:</span>
<span class="kw">term_stats</span>(crude, <span class="dt">drop_punct =</span> <span class="ot">TRUE</span>, <span class="dt">drop =</span> stopwords_en)</code></pre></div>
<pre><code>   term      count support
1  oil          85      20
2  said         73      20
3  reuter       20      20
4  prices       48      15
5  last         24      12
6  one          17      12
7  dlrs         23      11
8  opec         44      10
9  barrel       15      10
10 mln          31       9
11 crude        21       9
12 new          14       9
13 pct          14       9
14 price        13       9
15 also          9       9
16 petroleum     9       9
17 market       20       8
18 barrels      11       8
19 industry     10       8
20 world        10       8
⋮  (1042 rows total)</code></pre>
<p>The <code>as_corpus_frame()</code> and <code>as_corpus_text()</code> functions also work on <em>tm</em> Corpus objects:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># convert to corpus_text</span>
<span class="kw">print</span>(<span class="kw">as_corpus_text</span>(crude))</code></pre></div>
<pre><code>127 &quot;Diamond Shamrock Corp said that\neffective today it had cut its contract prices for crude oil…&quot;
144 &quot;OPEC may be forced to meet before a\nscheduled June session to readdress its production cutti…&quot;
191 &quot;Texaco Canada said it lowered the\ncontract price it will pay for crude oil 64 Canadian cts a…&quot;
194 &quot;Marathon Petroleum Co said it reduced\nthe contract price it will pay for all grades of crude…&quot;
211 &quot;Houston Oil Trust said that independent\npetroleum engineers completed an annual study that e…&quot;
236 &quot;Kuwait\&quot;s Oil Minister, in remarks\npublished today, said there were no plans for an emergenc…&quot;
237 &quot;Indonesia appears to be nearing a\npolitical crossroads over measures to deregulate its prote…&quot;
242 &quot;Saudi riyal interbank deposits were\nsteady at yesterday's higher levels in a quiet market.\n…&quot;
246 &quot;The Gulf oil state of Qatar, recovering\nslightly from last year's decline in world oil price…&quot;
248 &quot;Saudi Arabian Oil Minister Hisham Nazer\nreiterated the kingdom's commitment to last December…&quot;
273 &quot;Saudi crude oil output last month fell\nto an average of 3.5 mln barrels per day (bpd) from 3…&quot;
349 &quot;Deputy oil ministers from six Gulf\nArab states will meet in Bahrain today to discuss coordin…&quot;
352 &quot;Saudi Arabian Oil Minister Hisham Nazer\nreiterated the kingdom's commitment to last December…&quot;
353 &quot;Kuwait's oil minister said in a newspaper\ninterview that there were no plans for an emergenc…&quot;
368 &quot;The port of Philadelphia was closed\nwhen a Cypriot oil tanker, Seapride II, ran aground afte…&quot;
489 &quot;A study group said the United States\nshould increase its strategic petroleum reserve to one …&quot;
502 &quot;A study group said the United States\nshould increase its strategic petroleum reserve to one …&quot;
543 &quot;Unocal Corp's Union Oil Co said it\nlowered its posted prices for crude oil one to 1.50 dlrs …&quot;
704 &quot;The New York Mercantile Exchange set\nApril one for the debut of a new procedure in the energ…&quot;
708 &quot;Argentine crude oil production was\ndown 10.8 pct in January 1987 to 12.32 mln barrels, from …&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># convert to data frame</span>
<span class="kw">print</span>(<span class="kw">as_corpus_frame</span>(crude))</code></pre></div>
<pre><code>    text                                                                                            
127 Diamond Shamrock Corp said that\neffective today it had cut its contract prices for crude oil b…
144 OPEC may be forced to meet before a\nscheduled June session to readdress its production cutting…
191 Texaco Canada said it lowered the\ncontract price it will pay for crude oil 64 Canadian cts a\n…
194 Marathon Petroleum Co said it reduced\nthe contract price it will pay for all grades of crude o…
211 Houston Oil Trust said that independent\npetroleum engineers completed an annual study that est…
236 Kuwait&quot;s Oil Minister, in remarks\npublished today, said there were no plans for an emergency O…
237 Indonesia appears to be nearing a\npolitical crossroads over measures to deregulate its protect…
242 Saudi riyal interbank deposits were\nsteady at yesterday's higher levels in a quiet market.\n  …
246 The Gulf oil state of Qatar, recovering\nslightly from last year's decline in world oil prices,…
248 Saudi Arabian Oil Minister Hisham Nazer\nreiterated the kingdom's commitment to last December's…
273 Saudi crude oil output last month fell\nto an average of 3.5 mln barrels per day (bpd) from 3.8…
349 Deputy oil ministers from six Gulf\nArab states will meet in Bahrain today to discuss coordinat…
352 Saudi Arabian Oil Minister Hisham Nazer\nreiterated the kingdom's commitment to last December's…
353 Kuwait's oil minister said in a newspaper\ninterview that there were no plans for an emergency …
368 The port of Philadelphia was closed\nwhen a Cypriot oil tanker, Seapride II, ran aground after… 
489 A study group said the United States\nshould increase its strategic petroleum reserve to one ml…
502 A study group said the United States\nshould increase its strategic petroleum reserve to one ml…
543 Unocal Corp's Union Oil Co said it\nlowered its posted prices for crude oil one to 1.50 dlrs a… 
704 The New York Mercantile Exchange set\nApril one for the debut of a new procedure in the energy… 
708 Argentine crude oil production was\ndown 10.8 pct in January 1987 to 12.32 mln barrels, from 13…</code></pre>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
